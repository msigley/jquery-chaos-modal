/*
 * jQuery Chaos Modal
 * By Matthew Sigley
 * Based on concept work by Kevin Liew - http://www.queness.com/post/77/simple-jquery-modal-window-tutorial
 * Version 1.3.2
 */
(function(a){function m(a){var b=!1;a.data.alwaysAtTop&&(b=a.data.alwaysAtTop);l.resizeModal(b)}function d(a){a.preventDefault();l.closeModal()}function f(a){a.preventDefault();l.printModal()}function g(c){27==c.which&&(a(this).off("keyup",g),d(c))}var l,k;a.chaosModalIndex=0;a.fn.openModal=function(c){c=a.extend({},{maskClose:!0,maxWidth:960,closeLink:!0,printLink:!1,alwaysAtTop:!1},c);var b=this.clone(),n=a("body");a("html");var h=a(document),e=a(window),r=c.maskClose,s=c.closeLink,t=c.printLink, q=c.alwaysAtTop;k=c.maxWidth;l=b;b.attr({id:"chaos-current-modal"});var p=a('<div id="chaos-modal-mask" class="chaos-modal-mask"></div>');p.css({position:"absolute","z-index":"9000","background-color":"#000",display:"none",top:"0",left:"0"});p.appendTo(n);0==b.find(".print-link").length&&t&&(b.prepend('<a class="print-link">Print</a>'),b.children(".print-link").css({"float":"right",margin:"5px"}));0==b.find(".close-link").length&&s&&(b.prepend('<a class="close-link">Close</a>'),b.children(".close-link").css({"float":"right", margin:"5px"}));b.css({display:"block",position:"absolute",background:"#fff","z-index":"9001",left:"-10000px",margin:"0",padding:"0"});b.appendTo(n);c=function(){b.width()>k?b.width(k):b.width(b.width());b.hide();b.resizeModal(q);p.fadeIn(1E3);p.fadeTo("slow",.8);b.fadeIn(2E3);e.bind("resize",{alwaysAtTop:q},m);0<b.find(".print-link").length&&b.find(".print-link").bind("click",f);0<b.find(".close-link").length&&b.find(".close-link").bind("click",d);r&&(p.on("click",d),h.on("keyup",g))};n=b.find("img").last(); if(n.length)n.on("load",c);else c();b.show();return this};a.fn.closeModal=function(){l=null;a(window).unbind("resize",m);0<this.find(".close-link").length&&this.find(".close-link").unbind("click");this.hide().remove();a("#chaos-modal-mask").hide().remove();return this};a.fn.resizeModal=function(c){var b=a(document),d=a(window),h=a("html"),e=b.height(),f=h.width(),g=d.height(),h=d.width();e<this.height()&&(e=this.height());f<h&&(f=h);a("#chaos-modal-mask").css({width:f,height:e});e=g/2-this.height()/ 2;h=h/2-this.width()/2;0>e&&(e=0);0>h&&(h=0);c?d.scrollTop(0):(e+=d.scrollTop(),c=b.height()-(e+this.height()),0>c&&0<=e+c&&(e+=c));d.scrollLeft(0);this.css({top:e,left:h});return this};a.fn.printModal=function(){window.print()}})(jQuery); jQuery(document).ready(function(a){function m(d){var f=a(this);d.preventDefault();f.off("click",m);var g=f.parent().find(".chaos-modal-box").first();d=!1;var l=/\.(jpeg|jpg|gif|png|bmp|wbmp)$/i,k=!1;g.length?(d=a("<div></div>").css({padding:"20px"}),g.clone().appendTo(d),d=a("<div></div>").css({background:"#fff"}).append(d)):(l.test(f.attr("href"))?k=f.attr("href"):(g=f.find("img"),1==g.length&&l.test(g.attr("src"))&&(k=g.attr("src"))),k&&(testRequest=a.ajax(k,{type:"HEAD",async:!1}),200==testRequest.status&& (d=a("<div></div>").css({padding:"20px"}),a('<img src="'+k+'" />').css({display:"block"}).appendTo(d),d=a("<div></div>").css({background:"#fff"}).append(d))));d&&(f.attr({href:"#",id:"chaos-modal-link-"+a.chaosModalIndex}),d.attr({id:"chaos-modal-box-"+a.chaosModalIndex}),d.hide(),d.appendTo("body"),f.click(function(){var c=a(this).attr("id").match(/chaos-modal-link-(\d+)/i);c[1]&&(c=a("#chaos-modal-box-"+c[1]),1==c.length&&c.openModal());return!1}),f.click(),a.chaosModalIndex++);return!1}a(".chaos-modal-link").one("click", m)});