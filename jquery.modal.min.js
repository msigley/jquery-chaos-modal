/*
 * jQuery Chaos Modal
 * By Matthew Sigley
 * Based on concept work by Kevin Liew - http://www.queness.com/post/77/simple-jquery-modal-window-tutorial
 * Version 1.3.8
 */
(function(a){function g(c){var b=!1;c.data.alwaysAtTop&&(b=c.data.alwaysAtTop);a.chaosModalCurrent.resizeModal(b)}function h(c){c.preventDefault();a.chaosModalCurrent.closeModal()}function d(c){c.preventDefault();a.chaosModalCurrent.printModal()}function e(c){27==c.which&&(a(this).off("keyup",e),h(c))}a.chaosModalCurrent=null;a.chaosModalMaxWidth=0;a.chaosModalIndex=0;a.chaosModalImagesLoaded=!1;a.chaosModalIframesLoaded=!1;a.fn.openModal=function(c){c=a.extend({},{maskClose:!0,maxWidth:960,closeLink:!0, printLink:!1,alwaysAtTop:!1},c);this.find('iframe[src=""]').each(function(){var b=a(this),c=b.data("src");c&&b.attr("src",c)});var b=this.clone(),k=a("body");a("html");var p=a(document),f=a(window),q=c.maskClose,r=c.closeLink,s=c.printLink,n=c.alwaysAtTop;a.chaosModalMaxWidth=c.maxWidth;a.chaosModalCurrent=b;b.attr({id:"chaos-current-modal"});var l=a('<div id="chaos-modal-mask" class="chaos-modal-mask"></div>');l.css({position:"absolute","z-index":"9000","background-color":"#000",display:"none",top:"0", left:"0"});l.prependTo(k);0==b.find(".print-link").length&&s&&(b.prepend('<a class="print-link">Print</a>'),b.children(".print-link").css({"float":"right",margin:"5px"}));0==b.find(".close-link").length&&r&&(b.prepend('<a class="close-link">Close</a>'),b.children(".close-link").css({"float":"right",margin:"5px"}));b.css({display:"block",position:"absolute",background:"#fff","z-index":"9001",left:"-10000px",margin:"0",padding:"0"});b.prependTo(k);var m=function(){b.width()>a.chaosModalMaxWidth?b.width(a.chaosModalMaxWidth): b.width(b.width());b.find("img").css("max-width","100%");b.hide();b.resizeModal(n);l.fadeIn(1E3);l.fadeTo("slow",.8);b.fadeIn(2E3);f.bind("resize",{alwaysAtTop:n},g);0<b.find(".print-link").length&&b.find(".print-link").bind("click",d);0<b.find(".close-link").length&&b.find(".close-link").bind("click",h);q&&(l.on("click",h),p.on("keyup",e))};c=b.find("img").last();k=b.find("iframe").last();a.chaosModalImagesLoaded=c.length?!1:!0;a.chaosModalIframesLoaded=k.length?!1:!0;a.chaosModalImagesLoaded&&a.chaosModalIframesLoaded? m():(c.on("load",function(){a.chaosModalImagesLoaded=!0;a.chaosModalImagesLoaded&&a.chaosModalIframesLoaded&&m()}),k.on("load",function(){a.chaosModalIframesLoaded=!0;a.chaosModalImagesLoaded&&a.chaosModalIframesLoaded&&m()}));b.show();return this};a.fn.closeModal=function(){a.chaosModalCurrent=null;a(window).unbind("resize",g);0<this.find(".close-link").length&&this.find(".close-link").unbind("click");this.hide().remove();a("#chaos-modal-mask").hide().remove();return this};a.fn.resizeModal=function(c){var b= a(document),e=a(window),d=a("html"),f=b.height(),h=d.width(),g=e.height(),d=e.width();f<this.height()&&(f=this.height());h<d&&(h=d);a("#chaos-modal-mask").css({width:h,height:f});f=g/2-this.height()/2;d=d/2-this.width()/2;0>f&&(f=0);0>d&&(d=0);c?e.scrollTop(0):(f+=e.scrollTop(),c=b.height()-(f+this.height()),0>c&&0<=f+c&&(f+=c));e.scrollLeft(0);this.css({top:f,left:d});return this};a.fn.printModal=function(){window.print()}})(jQuery); jQuery(document).ready(function(a){function g(){var d=a(this),e=d.attr("src");d.attr("data-src",e).attr("src","")}function h(d){var e=a(this);d.preventDefault();e.off("click",h);var c=e.data("chaos-modal-box-id"),b=d=!1,k=/\.(jpeg|jpg|gif|png|bmp|wbmp)$/i,g=!1;d=c?a("#"+c).first():e.parent().find(".chaos-modal-box").first();d.length?(b=a("<div></div>").css({padding:"20px"}),d.clone().show().appendTo(b),b=a("<div></div>").css({background:"#fff"}).append(b)):(k.test(e.attr("href"))?g=e.attr("href"): (c=e.find("img"),1==c.length&&k.test(c.attr("src"))&&(g=c.attr("src"))),g&&(testRequest=a.ajax(g,{type:"HEAD",async:!1}),200==testRequest.status&&(b=a("<div></div>").css({padding:"20px"}),a('<img src="'+g+'" />').css({display:"block"}).appendTo(b),b=a("<div></div>").css({background:"#fff"}).append(b))));b&&(d.remove(),e.attr({href:"#",id:"chaos-modal-link-"+a.chaosModalIndex}),b.attr({id:"chaos-modal-box-"+a.chaosModalIndex}),b.hide(),b.appendTo("body"),e.click(function(){var b=a(this).attr("id").match(/chaos-modal-link-(\d+)/i); b[1]&&(b=a("#chaos-modal-box-"+b[1]),1==b.length&&b.openModal());return!1}),e.click(),a.chaosModalIndex++);return!1}a(".chaos-modal-link").not("a").each(function(){var d=a(this),e=d.children();d.removeClass("chaos-modal-link");e.not("a").length||1==e.length&&e.addClass("chaos-modal-link")});a("a.chaos-modal-link").one("click",h);a(".chaos-modal-box:hidden iframe").each(g);a(".chaos-modal-link").each(function(){var d=a(this).data("chaos-modal-box-id");d&&a("#"+d+":hidden iframe").each(g)})});