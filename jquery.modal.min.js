/*
 * jQuery Chaos Modal
 * By Matthew Sigley
 * Based on concept work by Kevin Liew - http://www.queness.com/post/77/simple-jquery-modal-window-tutorial
 * Version 1.3.6
 */
(function(a){function l(a){var b=!1;a.data.alwaysAtTop&&(b=a.data.alwaysAtTop);e.resizeModal(b)}function f(a){a.preventDefault();e.closeModal()}function d(a){a.preventDefault();e.printModal()}function h(c){27==c.which&&(a(this).off("keyup",h),f(c))}var e,k;a.chaosModalIndex=0;a.fn.openModal=function(c){c=a.extend({},{maskClose:!0,maxWidth:960,closeLink:!0,printLink:!1,alwaysAtTop:!1},c);var b=this.clone(),m=a("body");a("html");var q=a(document),g=a(window),r=c.maskClose,s=c.closeLink,t=c.printLink, p=c.alwaysAtTop;k=c.maxWidth;e=b;b.attr({id:"chaos-current-modal"});var n=a('<div id="chaos-modal-mask" class="chaos-modal-mask"></div>');n.css({position:"absolute","z-index":"9000","background-color":"#000",display:"none",top:"0",left:"0"});n.prependTo(m);0==b.find(".print-link").length&&t&&(b.prepend('<a class="print-link">Print</a>'),b.children(".print-link").css({"float":"right",margin:"5px"}));0==b.find(".close-link").length&&s&&(b.prepend('<a class="close-link">Close</a>'),b.children(".close-link").css({"float":"right", margin:"5px"}));b.css({display:"block",position:"absolute",background:"#fff","z-index":"9001",left:"-10000px",margin:"0",padding:"0"});b.prependTo(m);c=function(){b.width()>k?b.width(k):b.width(b.width());b.hide();b.resizeModal(p);n.fadeIn(1E3);n.fadeTo("slow",.8);b.fadeIn(2E3);g.bind("resize",{alwaysAtTop:p},l);0<b.find(".print-link").length&&b.find(".print-link").bind("click",d);0<b.find(".close-link").length&&b.find(".close-link").bind("click",f);r&&(n.on("click",f),q.on("keyup",h))};m=b.find("img").last(); if(m.length)m.on("load",c);else c();b.show();return this};a.fn.closeModal=function(){e=null;a(window).unbind("resize",l);0<this.find(".close-link").length&&this.find(".close-link").unbind("click");this.hide().remove();a("#chaos-modal-mask").hide().remove();return this};a.fn.resizeModal=function(c){var b=a(document),e=a(window),d=a("html"),g=b.height(),f=d.width(),h=e.height(),d=e.width();g<this.height()&&(g=this.height());f<d&&(f=d);a("#chaos-modal-mask").css({width:f,height:g});g=h/2-this.height()/ 2;d=d/2-this.width()/2;0>g&&(g=0);0>d&&(d=0);c?e.scrollTop(0):(g+=e.scrollTop(),c=b.height()-(g+this.height()),0>c&&0<=g+c&&(g+=c));e.scrollLeft(0);this.css({top:g,left:d});return this};a.fn.printModal=function(){window.print()}})(jQuery); jQuery(document).ready(function(a){function l(f){var d=a(this);f.preventDefault();d.off("click",l);var h=d.data("chaos-modal-box-id"),e=f=!1,k=/\.(jpeg|jpg|gif|png|bmp|wbmp)$/i,c=!1;f=h.length?a("#"+h).first():d.parent().find(".chaos-modal-box").first();f.length?(e=a("<div></div>").css({padding:"20px"}),f.clone().show().appendTo(e),e=a("<div></div>").css({background:"#fff"}).append(e)):(k.test(d.attr("href"))?c=d.attr("href"):(h=d.find("img"),1==h.length&&k.test(h.attr("src"))&&(c=h.attr("src"))), c&&(testRequest=a.ajax(c,{type:"HEAD",async:!1}),200==testRequest.status&&(e=a("<div></div>").css({padding:"20px"}),a('<img src="'+c+'" />').css({display:"block"}).appendTo(e),e=a("<div></div>").css({background:"#fff"}).append(e))));e&&(f.remove(),d.attr({href:"#",id:"chaos-modal-link-"+a.chaosModalIndex}),e.attr({id:"chaos-modal-box-"+a.chaosModalIndex}),e.hide(),e.appendTo("body"),d.click(function(){var b=a(this).attr("id").match(/chaos-modal-link-(\d+)/i);b[1]&&(b=a("#chaos-modal-box-"+b[1]),1== b.length&&b.openModal());return!1}),d.click(),a.chaosModalIndex++);return!1}a(".chaos-modal-link").not("a").each(function(){var f=a(this),d=f.children();f.removeClass("chaos-modal-link");d.not("a").length||1==d.length&&d.addClass("chaos-modal-link")});a("a.chaos-modal-link").one("click",l)});