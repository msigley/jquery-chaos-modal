/*
 * jQuery Chaos Modal
 * By Matthew Sigley
 * Based on concept work by Kevin Liew - http://www.queness.com/post/77/simple-jquery-modal-window-tutorial
 * Version 1.3.3
 */
(function(a){function l(a){var c=!1;a.data.alwaysAtTop&&(c=a.data.alwaysAtTop);k.resizeModal(c)}function b(a){a.preventDefault();k.closeModal()}function d(a){a.preventDefault();k.printModal()}function g(e){27==e.which&&(a(this).off("keyup",g),b(e))}var k,h;a.chaosModalIndex=0;a.fn.openModal=function(e){e=a.extend({},{maskClose:!0,maxWidth:960,closeLink:!0,printLink:!1,alwaysAtTop:!1},e);var c=this.clone(),m=a("body");a("html");var q=a(document),f=a(window),r=e.maskClose,s=e.closeLink,t=e.printLink, p=e.alwaysAtTop;h=e.maxWidth;k=c;c.attr({id:"chaos-current-modal"});var n=a('<div id="chaos-modal-mask" class="chaos-modal-mask"></div>');n.css({position:"absolute","z-index":"9000","background-color":"#000",display:"none",top:"0",left:"0"});n.appendTo(m);0==c.find(".print-link").length&&t&&(c.prepend('<a class="print-link">Print</a>'),c.children(".print-link").css({"float":"right",margin:"5px"}));0==c.find(".close-link").length&&s&&(c.prepend('<a class="close-link">Close</a>'),c.children(".close-link").css({"float":"right", margin:"5px"}));c.css({display:"block",position:"absolute",background:"#fff","z-index":"9001",left:"-10000px",margin:"0",padding:"0"});c.appendTo(m);e=function(){c.width()>h?c.width(h):c.width(c.width());c.hide();c.resizeModal(p);n.fadeIn(1E3);n.fadeTo("slow",.8);c.fadeIn(2E3);f.bind("resize",{alwaysAtTop:p},l);0<c.find(".print-link").length&&c.find(".print-link").bind("click",d);0<c.find(".close-link").length&&c.find(".close-link").bind("click",b);r&&(n.on("click",b),q.on("keyup",g))};m=c.find("img").last(); if(m.length)m.on("load",e);else e();c.show();return this};a.fn.closeModal=function(){k=null;a(window).unbind("resize",l);0<this.find(".close-link").length&&this.find(".close-link").unbind("click");this.hide().remove();a("#chaos-modal-mask").hide().remove();return this};a.fn.resizeModal=function(e){var c=a(document),b=a(window),d=a("html"),f=c.height(),g=d.width(),h=b.height(),d=b.width();f<this.height()&&(f=this.height());g<d&&(g=d);a("#chaos-modal-mask").css({width:g,height:f});f=h/2-this.height()/ 2;d=d/2-this.width()/2;0>f&&(f=0);0>d&&(d=0);e?b.scrollTop(0):(f+=b.scrollTop(),e=c.height()-(f+this.height()),0>e&&0<=f+e&&(f+=e));b.scrollLeft(0);this.css({top:f,left:d});return this};a.fn.printModal=function(){window.print()}})(jQuery); jQuery(document).ready(function(a){function l(b){var d=a(this);b.preventDefault();d.off("click",l);var g=d.parent().find(".chaos-modal-box").first();b=!1;var k=/\.(jpeg|jpg|gif|png|bmp|wbmp)$/i,h=!1;g.length?(b=a("<div></div>").css({padding:"20px"}),g.clone().appendTo(b),b=a("<div></div>").css({background:"#fff"}).append(b)):(k.test(d.attr("href"))?h=d.attr("href"):(g=d.find("img"),1==g.length&&k.test(g.attr("src"))&&(h=g.attr("src"))),h&&(testRequest=a.ajax(h,{type:"HEAD",async:!1}),200==testRequest.status&& (b=a("<div></div>").css({padding:"20px"}),a('<img src="'+h+'" />').css({display:"block"}).appendTo(b),b=a("<div></div>").css({background:"#fff"}).append(b))));b&&(d.attr({href:"#",id:"chaos-modal-link-"+a.chaosModalIndex}),b.attr({id:"chaos-modal-box-"+a.chaosModalIndex}),b.hide(),b.appendTo("body"),d.click(function(){var b=a(this).attr("id").match(/chaos-modal-link-(\d+)/i);b[1]&&(b=a("#chaos-modal-box-"+b[1]),1==b.length&&b.openModal());return!1}),d.click(),a.chaosModalIndex++);return!1}a(".chaos-modal-link").not("a").each(function(){var b= a(this),d=b.children();b.removeClass("chaos-modal-link");d.not("a").length||1==d.length&&d.addClass("chaos-modal-link")});a("a.chaos-modal-link").one("click",l)});