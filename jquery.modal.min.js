/*
 * jQuery Chaos Modal
 * By Matthew Sigley
 * Based on concept work by Kevin Liew - http://www.queness.com/post/77/simple-jquery-modal-window-tutorial
 * Version 1.4.1
 */
(function(a){function h(){var a="undefined"!==typeof navigator?navigator.userAgent:"";return/msie|trident/i.test(a)?(a=a.match(/(?:msie |rv:)(\d+(\.\d+)?)/i))&&1<a.length&&a[1]||"":""}function p(b){var e=!1;b.data.alwaysAtTop&&(e=b.data.alwaysAtTop);a.chaosModalCurrent.resizeModal(e)}function f(b){b.preventDefault();if(500>Date.now()-a.openTime)return!1;a(document).off(".chaosmodal");null!=a.chaosModalCurrent?a.chaosModalCurrent.closeModal():(a(window).trigger("chaos-modal-preprocess-interrupt"),
a("#chaos-modal-mask").hide().remove(),a.fn.closeLoading());a.modalMask=null}function d(b){b.preventDefault();a.chaosModalCurrent.printModal()}function q(a){27==a.which&&f(a)}function k(){var b=a(document),e=a(window),c=a("html"),b=b.height(),c=c.width(),l=e.height(),e=e.width();a("#chaos-modal-mask").css({width:c,height:b});posx=e/2-parseInt(a("#modal-loading").css("width"))/2;posy=l/2-parseInt(a("#modal-loading").css("height"))/2;a.chaosModalLoading=a("#modal-loading");a.chaosModalLoading.css("top",
posy);a.chaosModalLoading.css("left",posx)}a(window);var n="",n=bowser.msie?bowser.version:h(),m=function(a){if(null===a.offsetParent)return!1;if(11>n){var e="";"undefined"!=typeof getComputedStyle?e=window.getComputedStyle(a).display:"undefined"!=typeof a.currentStyle&&(e=a.currentStyle.display);if("none"==e||"fixed"==e||"absolute"==e)return!1}return!0};a.chaosModalLoading=null;a.modalMask=null;a.chaosModalCurrent=null;a.chaosModalMaxWidth=0;a.chaosModalIndex=0;a.chaosModalImagesLoaded=!1;a.chaosModalIframesLoaded=
!1;a.fn.openModal=function(b){function e(){var b=a(this),c=b.data("src");c&&b.attr("src",c).attr("data-src","")}if(null==a.chaosModalCurrent){b=a.extend({},{maxWidth:960,closeLink:!0,printLink:!1,alwaysAtTop:!1,preprocessing:!1},b);this.find('iframe[src=""]').each(e);var c=this.clone(!0),l=a("body");a("html");a(document);var g=a(window),k=b.closeLink,q=b.printLink,h=b.alwaysAtTop;a.chaosModalMaxWidth=b.maxWidth;a.chaosModalCurrent=c;c.attr({id:"chaos-current-modal"});0==c.find(".print-link").length&&
q&&(c.prepend('<a class="print-link">Print</a>'),c.children(".print-link").css({"float":"right",margin:"5px"}));0==c.find(".close-link").length&&k&&(c.prepend('<a class="close-link">Close</a>'),c.children(".close-link").css({"float":"right",margin:"5px"}));c.css({display:"block",position:"absolute",background:"#fff","z-index":"9002",left:"-10000px",margin:"0",padding:"0"});c.prependTo(l);var r=function(){c.width()>a.chaosModalMaxWidth?c.width(a.chaosModalMaxWidth):c.width(c.width());c.find("img").css("max-width",
"100%");c.hide();c.resizeModal(h);a.modalMask.stop();c.fadeIn(2E3,function(){c.resizeModal(h);g.bind("resize",{alwaysAtTop:h},p);a.fn.closeLoading()});0<c.find(".print-link").length&&c.find(".print-link").bind("click",d);0<c.find(".close-link").length&&c.find(".close-link").bind("click",f)};b=c.find("img").filter(function(a,b){return!m(b)||b.complete||"undefined"==typeof b.naturalWidth||0!=b.naturalWidth?!1:!0});l=c.find("iframe").filter(function(a,b){return n||!m(b)||"complete"==(b.contentDocument||
b.contentWindow.document).readyState?!1:!0});a.imagesToLoad=b.length;a.iframesToLoad=l.length;a.imagesToLoad||a.iframesToLoad?(b.on("load",function(){--a.imagesToLoad;a.imagesToLoad||a.iframesToLoad||r()}),l.on("load",function(){--a.iframesToLoad;a.imagesToLoad||a.iframesToLoad||r()})):r();c.show();return this}};a.fn.closeModal=function(){a(window).unbind("resize",p);a.chaosModalCurrent=null;0<this.find(".close-link").length&&this.find(".close-link").unbind("click");this.hide().remove();a("#chaos-modal-mask").hide().remove();
a.fn.closeLoading();return this};a.fn.resizeModal=function(b){var e=a(document),c=a(window),l=a("html"),g=e.height(),f=l.width(),d=c.height(),l=c.width();g<this.height()&&(g=this.height());f<l&&(f=l);a("#chaos-modal-mask").css({width:f,height:g});g=d/2-this.height()/2;l=l/2-this.width()/2;0>g&&(g=0);0>l&&(l=0);b?c.scrollTop(0):(g+=c.scrollTop(),b=e.height()-(g+this.height()),0>b&&0<=g+b&&(g+=b));c.scrollLeft(0);this.css({top:g,left:l});return this};a.fn.printModal=function(){window.print()};a.fn.showLoading=
function(){a.openTime=Date.now();if(null==a.modalMask){var b=a("body"),e=a(window),c=e.height(),d=e.width();maskClose=!0;a.modalMask=a('<div id="chaos-modal-mask" class="chaos-modal-mask"></div>');a.modalMask.css({position:"absolute","z-index":"9000","background-color":"#000",display:"none",top:"0",left:"0"});a.modalMask.prependTo(b);a.modalMask.fadeIn(500);a.modalMask.fadeTo("fast",.8);var b=a(document),e=a(window),g=a("html"),h=b.height(),g=g.width();maskClose&&(a.modalMask.on("click",f),b.on("keyup.chaosmodal",
q));h<this.height()&&(h=this.height());g<d&&(g=d);a("#chaos-modal-mask").css({width:g,height:h});a("body").append('<div id="modal-loading" style="position: fixed; z-index: 9001; color: #fff;">Loading</div>');posx=d/2-parseInt(a("#modal-loading").css("width"))/2;posy=c/2-parseInt(a("#modal-loading").css("height"))/2;a.chaosModalLoading=a("#modal-loading");a.chaosModalLoading.css("top",posy);a.chaosModalLoading.css("left",posx);e.bind("resize",{alwaysAtTop:!0},k)}};a.fn.closeLoading=function(){a.chaosModalLoading.remove()}})(jQuery);
jQuery(document).ready(function(a){function h(){var f=a(this),d=f.attr("src");f.attr("data-src",d).attr("src","")}function p(f){var d=a(this);f.preventDefault();d.off("click",p);var h=d.data("chaos-modal-box-id"),k=f=!1,n=/\.(jpeg|jpg|gif|png|bmp|wbmp)$/i,m=!1;f=h?a("#"+h).first():d.parent().find(".chaos-modal-box").first();f.length?(k=a("<div></div>").css({padding:"20px"}),f.clone(!0).css({display:"block"}).appendTo(k),k=a("<div></div>").css({background:"#fff"}).append(k)):(n.test(d.attr("href"))?
m=d.attr("href"):(h=d.find("img"),1==h.length&&n.test(h.attr("src"))&&(m=h.attr("src"))),m&&(testRequest=a.ajax(m,{type:"HEAD",async:!1}),200==testRequest.status&&(k=a("<div></div>").css({padding:"20px"}),a('<img src="'+m+'" />').css({display:"block"}).appendTo(k),k=a("<div></div>").css({background:"#fff"}).append(k))));k&&(f.remove(),d.attr({href:"#",id:"chaos-modal-link-"+a.chaosModalIndex}),k.attr({id:"chaos-modal-box-"+a.chaosModalIndex}),k.hide(),k.appendTo("body"),d.click(function(){a.fn.showLoading();
preprocess=d.attr("data-preprocess");var b=a(this).attr("id").match(/chaos-modal-link-(\d+)/i);b[1]&&(b=a("#chaos-modal-box-"+b[1]),1==b.length&&"true"!=preprocess?b.openModal():1==b.length&&"true"==preprocess&&d.trigger("chaos-modal-preprocess",b));return!1}),d.click(),a.chaosModalIndex++);return!1}a(".chaos-modal-link").not("a").each(function(){var f=a(this),d=f.children();f.removeClass("chaos-modal-link");d.not("a").length||1==d.length&&d.addClass("chaos-modal-link")});a("a.chaos-modal-link").on("click",
p);a(".chaos-modal-box:hidden iframe").each(h);a(".chaos-modal-link").each(function(){var f=a(this).data("chaos-modal-box-id");f&&a("#"+f+":hidden iframe").each(h)});Date.now||(Date.now=function(){return(new Date).getTime()})});